<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpårplanV2 - Professionell Tågtrafikledning</title>
    
    <!-- 1. Design System Foundation -->
    <link rel="stylesheet" href="styles/design-system.css">
    <link rel="stylesheet" href="styles/typography.css">
    <link rel="stylesheet" href="styles/variables.css">
    
    <!-- 2. Themes -->
    <link rel="stylesheet" href="styles/themes.css">
    
    <!-- 3. Base & Layout -->
    <link rel="stylesheet" href="styles/base.css">
    
    <!-- 4. Components -->
    <link rel="stylesheet" href="styles/components/buttons.css">
    <link rel="stylesheet" href="styles/components/header-base.css">
    <link rel="stylesheet" href="styles/components/header-time-controls.css">
    <link rel="stylesheet" href="styles/components/header-status.css">
    <link rel="stylesheet" href="styles/components/logo.css">
    <link rel="stylesheet" href="styles/components/schedule.css">
    <link rel="stylesheet" href="styles/components/settings-modal.css">
    <link rel="stylesheet" href="styles/components/settings-controls.css">
    <link rel="stylesheet" href="styles/components/tracks.css">
    <link rel="stylesheet" href="styles/components/timeline.css">
    <link rel="stylesheet" href="styles/components/trains.css">
    
    <!-- Data Files -->
    <script src="../vehicleTypes.js"></script>
    <script src="../tracks.js"></script>
    <script src="../trains.js"></script>
    
    <style>
        /* Temporary demo styles to show off our design system */
        .demo-container {
            padding: var(--spacing-8);
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .demo-section {
            margin-bottom: var(--spacing-12);
            padding: var(--spacing-6);
            background: var(--surface-primary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
        }
        
        .demo-section h2 {
            color: var(--text-primary);
            margin-bottom: var(--spacing-4);
            border-bottom: 2px solid var(--border-primary);
            padding-bottom: var(--spacing-2);
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--spacing-4);
            margin-top: var(--spacing-4);
        }
        
        .color-swatch {
            height: 80px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: flex-end;
            padding: var(--spacing-2);
            font-size: var(--font-size-sm);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: var(--shadow-sm);
        }
        
        .button-demo {
            display: flex;
            gap: var(--spacing-4);
            flex-wrap: wrap;
            margin-top: var(--spacing-4);
        }
        
        .btn {
            padding: var(--spacing-3) var(--spacing-6);
            border: none;
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-normal);
        }
        
        .btn-primary {
            background: var(--interactive-primary);
            color: var(--text-inverse);
        }
        
        .btn-primary:hover {
            background: var(--interactive-primary-hover);
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--interactive-secondary);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: var(--interactive-secondary-hover);
        }
        
        .btn-success {
            background: var(--success-600);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--success-700);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--warning-500);
            color: white;
        }
        
        .btn-warning:hover {
            background: var(--warning-600);
        }
        
        .btn-danger {
            background: var(--interactive-danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: var(--interactive-danger-hover);
        }
        
        .typography-demo p {
            margin: var(--spacing-2) 0;
        }
        
        .theme-toggle {
            position: fixed;
            top: var(--spacing-4);
            right: var(--spacing-4);
            z-index: 1000;
            padding: var(--spacing-3) var(--spacing-5);
            background: var(--surface-elevated);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            gap: var(--spacing-3);
        }
        
        .theme-btn {
            padding: var(--spacing-2) var(--spacing-4);
            border: 2px solid var(--border-primary);
            background: var(--surface-secondary);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            transition: all var(--transition-fast);
        }
        
        .theme-btn:hover {
            background: var(--interactive-primary);
            color: white;
            border-color: var(--interactive-primary);
        }
        
        .theme-btn.active {
            background: var(--interactive-primary);
            color: white;
            border-color: var(--interactive-primary);
        }
        
        .spacing-demo {
            display: flex;
            gap: var(--spacing-2);
            flex-wrap: wrap;
            margin-top: var(--spacing-4);
        }
        
        .spacing-box {
            background: var(--primary-200);
            border: 2px solid var(--primary-600);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
            color: var(--primary-800);
        }
    </style>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-main">Hoppa till huvudinnehåll</a>
    
    <!-- Main Application Header -->
    <header class="app-header" role="banner">
        <!-- Left Section: Logo & Title -->
        <div class="header-left">
            <a href="/" class="header-logo">
                <img src="assets/logo.png" alt="SpårplanV2 Logo" class="app-logo">
                <div>
                    <h1 class="header-title">SpårplanV2</h1>
                    <p class="header-subtitle">Professionell Tågtrafikledning</p>
                </div>
            </a>
        </div>
        
        <!-- Center Section: Time Controls -->
        <nav class="header-center" aria-label="Tidskontroller">
            <div class="time-controls">
                <div class="time-nav">
                    <button id="time-nav-prev" class="btn btn-secondary btn-icon" aria-label="Föregående tidsintervall" title="Föregående tidsintervall">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20"><path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" /></svg>
                    </button>
                    <button id="time-nav-next" class="btn btn-secondary btn-icon" aria-label="Nästa tidsintervall" title="Nästa tidsintervall">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                
                <div class="time-display">
                    <div class="time-display-current" id="current-time-display">14:30</div>
                    <div class="time-display-range" id="time-range-display">14:00 - 18:00</div>
                </div>
                
                <button class="btn btn-primary btn-now" id="now-button">
                    <span>Nu</span>
                </button>
                
                <div class="time-range-selector">
                    <button class="btn btn-secondary btn-sm time-range-button" id="time-range-btn" aria-label="Välj tidsintervall">
                        <span>4h</span>
                    </button>
                    <div class="time-range-dropdown" id="time-range-dropdown">
                        <div class="time-range-option" data-hours="1">1 timme</div>
                        <div class="time-range-option" data-hours="3">3 timmar</div>
                        <div class="time-range-option active" data-hours="4">4 timmar</div>
                        <div class="time-range-option" data-hours="6">6 timmar</div>
                        <div class="time-range-option" data-hours="8">8 timmar</div>
                        <div class="time-range-option" data-hours="12">12 timmar</div>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Right Section: Status & Settings -->
        <div class="header-right">
            <div class="status-badge connected" id="api-status" title="API-status">
                <span class="status-badge-text">Ansluten</span>
            </div>
            
            <button class="btn btn-icon theme-toggle" id="theme-toggle-btn" aria-label="Byt tema" title="Byt tema">
                <span style="font-size: 20px;">🌓</span>
            </button>
            
            <button class="btn btn-icon settings-button" aria-label="Inställningar" title="Inställningar">
                <span style="font-size: 20px;">⚙️</span>
            </button>
        </div>
    </header>

      <!-- Main Content -->
      <main id="main-content" style="margin-top: var(--header-height); padding: 0; overflow: hidden;">

          <!-- Schedule View - Subfas 1.3 -->
          <div class="schedule-wrapper">
              <div class="schedule-container" id="schedule-container" role="region" aria-label="Tågschema">
                  <!-- Corner cell -->
                  <div class="schedule-corner">Spår</div>

                  <!-- Timeline header -->
                  <div class="schedule-timeline-header">
                      <div class="timeline-hours" id="timeline-hours">
                          <!-- Dynamically generated time markers -->
                      </div>
                  </div>

                  <!-- Track labels -->
                  <div class="schedule-track-labels" id="track-labels">
                      <!-- Dynamically generated track rows -->
                  </div>

                  <!-- Timeline grid area -->
                  <div class="schedule-grid-area" id="schedule-grid">
                      <div class="timeline-canvas" id="timeline-canvas">
                          <!-- Track rows and train bars are rendered here by JS -->
                      </div>
                  </div>
  
                  <div class="schedule-scroll-hint">← Scrolla horisontellt →</div>
              </div>
          </div>
      </main>

    <!-- Settings Modal -->
    <div id="settings-backdrop" class="settings-backdrop hidden" role="dialog" aria-labelledby="settings-title" aria-modal="true">
        <div id="settings-modal" class="settings-modal">
            <!-- Header -->
            <div class="settings-header">
                <h2 id="settings-title" class="settings-title">Inställningar</h2>
                <button id="settings-close-btn" class="settings-close-btn" aria-label="Stäng inställningar">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <!-- Tabs Navigation -->
            <div class="settings-tabs" role="tablist">
                <button class="settings-tab active" data-tab="time" role="tab" aria-selected="true" aria-controls="panel-time">
                    Tidshantering
                </button>
                <button class="settings-tab" data-tab="display" role="tab" aria-selected="false" aria-controls="panel-display">
                    Visning
                </button>
                <button class="settings-tab" data-tab="data" role="tab" aria-selected="false" aria-controls="panel-data">
                    Data
                </button>
                <button class="settings-tab" data-tab="about" role="tab" aria-selected="false" aria-controls="panel-about">
                    Om
                </button>
            </div>

            <!-- Content Area -->
            <div class="settings-content">
                <!-- Time Management Tab -->
                <div id="panel-time" class="settings-tab-panel active" data-tab-panel="time" role="tabpanel">
                    <div class="settings-section">
                        <h3 class="settings-section-title">Nu-knapp Inställningar</h3>
                        <div class="settings-section-content">
                            <!-- Offset Slider -->
                            <div class="setting-item">
                                <label class="setting-label" for="offset-slider">Röd linje position</label>
                                <div class="settings-slider-container">
                                    <div class="settings-slider-wrapper">
                                        <div id="offset-slider" class="settings-slider">
                                            <div id="offset-slider-track" class="settings-slider-track"></div>
                                            <div id="offset-slider-thumb" class="settings-slider-thumb"></div>
                                        </div>
                                        <span id="offset-value" class="settings-slider-value">20%</span>
                                    </div>
                                </div>
                                <p class="setting-help">Position för röd linje från vänsterkanten (0-50%). Vid 20% är linjen nära vänster kant, vid 50% i mitten.</p>
                            </div>

                            <!-- Follow Mode Toggle -->
                            <div class="setting-item">
                                <label class="setting-label" for="follow-mode">Aktivera följ-läge</label>
                                <div class="setting-control">
                                    <div class="settings-toggle-wrapper">
                                        <button id="follow-mode" class="settings-toggle" aria-label="Aktivera följ-läge">
                                            <span class="settings-toggle-knob"></span>
                                        </button>
                                    </div>
                                </div>
                                <p class="setting-help">Aktiverar automatisk scrollning som följer tiden.</p>
                            </div>

                            <!-- Update Interval Select -->
                            <div class="setting-item">
                                <label class="setting-label" for="update-interval">Uppdateringsintervall</label>
                                <div class="settings-select-wrapper">
                                    <select id="update-interval" class="settings-select" aria-label="Uppdateringsintervall">
                                        <option value="30">30 sekunder</option>
                                        <option value="60" selected>60 sekunder</option>
                                        <option value="120">120 sekunder</option>
                                        <option value="300">5 minuter</option>
                                    </select>
                                </div>
                                <p class="setting-help">Hur ofta vyn ska uppdateras i följ-läge.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Display Tab -->
                <div id="panel-display" class="settings-tab-panel" data-tab-panel="display" role="tabpanel" hidden>
                    <div class="settings-empty">
                        <p>Kommer snart</p>
                    </div>
                </div>

                <!-- Data Tab -->
                <div id="panel-data" class="settings-tab-panel" data-tab-panel="data" role="tabpanel" hidden>
                    <div class="settings-empty">
                        <p>Kommer snart</p>
                    </div>
                </div>

                <!-- About Tab -->
                <div id="panel-about" class="settings-tab-panel" data-tab-panel="about" role="tabpanel" hidden>
                    <div class="settings-section">
                        <div class="settings-section-content">
                            <div class="setting-item">
                                <h3 class="setting-label">SpårplanV2</h3>
                                <p class="setting-help">Professionellt järnvägstrafikledningssystem</p>
                            </div>
                            <div class="setting-item">
                                <p class="setting-help" style="font-size: var(--text-xs);">Version 2.0.0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="settings-footer">
                <button id="settings-reset-btn" class="btn btn-secondary">
                    Återställ standardvärden
                </button>
                <div class="settings-footer-actions">
                    <button id="settings-cancel-btn" class="btn btn-secondary">
                        Avbryt
                    </button>
                    <button id="settings-save-btn" class="btn btn-primary">
                        Spara ändringar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files - Load in correct order -->
    <script src="js/theme.js"></script>
    <script src="js/modules/time-manager.js"></script>
    <script src="js/components/settings-controls.js"></script>
    <script src="js/components/settings-modal.js"></script>
    <script src="js/modules/header-controls.js"></script>
    <script src="js/modules/schedule-renderer.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // Legacy theme switcher function for compatibility
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('sparplannen-theme', theme);
            console.log(`✅ Theme switched to: ${theme}`);
        }
    </script>
</body>
</html>
