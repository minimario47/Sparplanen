<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sp√•rplanV2</title>
    
    <!-- 1. Design System Foundation -->
    <link rel="stylesheet" href="styles/design-system.css">
    <link rel="stylesheet" href="styles/typography.css">
    <link rel="stylesheet" href="styles/variables.css">
    
    <!-- 2. Themes -->
    <link rel="stylesheet" href="styles/themes.css">
    
    <!-- 3. Base & Layout -->
    <link rel="stylesheet" href="styles/base.css">
    
    <!-- 4. Components -->
    <link rel="stylesheet" href="styles/components/buttons.css">
    <link rel="stylesheet" href="styles/components/header-base.css">
    <link rel="stylesheet" href="styles/components/header-time-controls.css">
    <link rel="stylesheet" href="styles/components/header-status.css">
    <link rel="stylesheet" href="styles/components/logo.css">
    <link rel="stylesheet" href="styles/components/theme-switch.css">
    <link rel="stylesheet" href="styles/components/notifications.css">
    <link rel="stylesheet" href="styles/components/schedule.css">
    <link rel="stylesheet" href="styles/components/settings-modal.css">
    <link rel="stylesheet" href="styles/components/settings-controls.css">
    <!-- New Form Components -->
    <link rel="stylesheet" href="styles/components/forms-base.css">
    <link rel="stylesheet" href="styles/components/forms-toggle.css">
    <link rel="stylesheet" href="styles/components/forms-slider.css">
    <link rel="stylesheet" href="styles/components/forms-select.css">
    <link rel="stylesheet" href="styles/components/forms-radio-group.css">
    <link rel="stylesheet" href="styles/components/search-highlights.css">
    <link rel="stylesheet" href="styles/components/search-inline.css">
    <link rel="stylesheet" href="styles/components/tracks.css">
    <link rel="stylesheet" href="styles/components/timeline.css">
    <link rel="stylesheet" href="styles/components/trains.css">
    <link rel="stylesheet" href="styles/components/track-tooltip.css">
    <link rel="stylesheet" href="styles/components/train-tooltip.css">
    <link rel="stylesheet" href="styles/components/delay-visualization.css">
    <link rel="stylesheet" href="styles/components/debug-logs.css">
    
    <!-- Data Files -->
    <script src="vehicleTypes.js"></script>
    <script src="tracks.js"></script>
    <script src="trains.js"></script>
    
    <style>
        /* Temporary demo styles to show off our design system */
        .demo-container {
            padding: var(--spacing-8);
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .demo-section {
            margin-bottom: var(--spacing-12);
            padding: var(--spacing-6);
            background: var(--surface-primary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
        }
        
        .demo-section h2 {
            color: var(--text-primary);
            margin-bottom: var(--spacing-4);
            border-bottom: 2px solid var(--border-primary);
            padding-bottom: var(--spacing-2);
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--spacing-4);
            margin-top: var(--spacing-4);
        }
        
        .color-swatch {
            height: 80px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: flex-end;
            padding: var(--spacing-2);
            font-size: var(--font-size-sm);
            color: var(--text-inverse);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: var(--shadow-sm);
        }
        
        .button-demo {
            display: flex;
            gap: var(--spacing-4);
            flex-wrap: wrap;
            margin-top: var(--spacing-4);
        }
        
        
        .typography-demo p {
            margin: var(--spacing-2) 0;
        }
        
        .theme-toggle {
            position: fixed;
            top: var(--spacing-4);
            right: var(--spacing-4);
            z-index: 1000;
            padding: var(--spacing-3) var(--spacing-5);
            background: var(--surface-elevated);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            gap: var(--spacing-3);
        }
        
        .theme-btn {
            padding: var(--spacing-2) var(--spacing-4);
            border: 2px solid var(--border-primary);
            background: var(--surface-secondary);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            transition: all var(--transition-fast);
        }
        
        .theme-btn:hover {
            background: var(--interactive-primary);
            color: var(--text-inverse);
            border-color: var(--interactive-primary);
        }
        
        .theme-btn.active {
            background: var(--interactive-primary);
            color: var(--text-inverse);
            border-color: var(--interactive-primary);
        }
        
        .spacing-demo {
            display: flex;
            gap: var(--spacing-2);
            flex-wrap: wrap;
            margin-top: var(--spacing-4);
        }
        
        .spacing-box {
            background: var(--primary-200);
            border: 2px solid var(--primary-600);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
            color: var(--primary-800);
        }
    </style>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-main">Hoppa till huvudinneh√•ll</a>
    
    <!-- Main Application Header -->
    <header class="app-header" role="banner">
        <!-- Left Section: Logo & Title -->
        <div class="header-left">
            <a href="/" class="header-logo">
                <img src="assets/logo.png" alt="Sp√•rplanV2 Logo" class="app-logo">
                <div class="header-title-block">
                    <h1 class="header-title">Sp√•rplanV2</h1>
                    <div class="network-status" id="api-status" title="Connection Status">
                        <div class="network-nodes">
                            <div class="node node-1"></div>
                            <div class="node node-2"></div>
                            <div class="connection-line"></div>
                            <div class="node node-3"></div>
                        </div>
                </div>
                </div>
            </a>
            </div>

        <!-- Center Section: Time Controls -->
        <nav class="header-center" aria-label="Tidskontroller">
            <div class="time-controls">
                <div class="time-nav btn-group">
                    <button id="time-nav-prev" class="btn btn-secondary btn-icon" aria-label="F√∂reg√•ende tidsintervall" title="F√∂reg√•ende tidsintervall">
                        <img src="assets/Icons/next.png" alt="Previous" class="icon-svg" style="transform: scaleX(-1);">
                    </button>
                    <button id="time-nav-next" class="btn btn-secondary btn-icon" aria-label="N√§sta tidsintervall" title="N√§sta tidsintervall">
                        <img src="assets/Icons/next.png" alt="Next" class="icon-svg">
                </button>
                </div>

                <div class="time-center btn-group">
                    <button class="btn btn-primary btn-now" id="now-button">
                        <span>Nu</span>
                    </button>
                    <div class="time-display group-segment">
                        <div class="time-display-current" id="current-time-display">14:30</div>
                        <div class="time-display-range" id="time-range-display">14:00 - 18:00</div>
                    </div>
                    <button class="btn btn-secondary time-range-button" id="time-range-btn" aria-label="V√§lj tidsintervall">
                        <span>4h</span>
                    </button>
                </div>

                <div class="time-range-dropdown" id="time-range-dropdown">
                    <div class="time-range-option" data-hours="1">1 timme</div>
                    <div class="time-range-option" data-hours="3">3 timmar</div>
                    <div class="time-range-option active" data-hours="4">4 timmar</div>
                    <div class="time-range-option" data-hours="6">6 timmar</div>
                    <div class="time-range-option" data-hours="8">8 timmar</div>
                    <div class="time-range-option" data-hours="12">12 timmar</div>
                </div>
            </div>
        </nav>
        
        <!-- Right Section: Status & Settings -->
        <div class="header-right">
            <div class="btn-group header-actions">
                <div class="search" id="search-form" role="search" aria-label="S√∂k t√•gnummer">
                    <input type="text" id="search-input" placeholder=" " aria-label="S√∂k t√•gnummer" autocomplete="off" spellcheck="false" />
                    <div>
                        <svg>
                            <use xlink:href="#search-path"></use>
                        </svg>
                    </div>
        </div>

                <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                    <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 160 28" id="search-path">
                        <path d="M32.9418651,-20.6880772 C37.9418651,-20.6880772 40.9418651,-16.6880772 40.9418651,-12.6880772 C40.9418651,-8.68807717 37.9418651,-4.68807717 32.9418651,-4.68807717 C27.9418651,-4.68807717 24.9418651,-8.68807717 24.9418651,-12.6880772 C24.9418651,-16.6880772 27.9418651,-20.6880772 32.9418651,-20.6880772 L32.9418651,-29.870624 C32.9418651,-30.3676803 33.3448089,-30.770624 33.8418651,-30.770624 C34.08056,-30.770624 34.3094785,-30.6758029 34.4782612,-30.5070201 L141.371843,76.386562" transform="translate(83.156854, 22.171573) rotate(-225.000000) translate(-83.156854, -22.171573)"></path>
                    </symbol>
                </svg>
                <button class="btn btn-secondary btn-icon theme-toggle" id="theme-toggle-btn" aria-label="Byt tema" title="Byt tema">
                    <span style="font-size: 20px;">üåì</span>
                </button>
                <button class="btn btn-secondary btn-icon settings-button" aria-label="Inst√§llningar" title="Inst√§llningar">
                    <img src="assets/Icons/settings.png" alt="Settings" class="icon-svg">
                </button>
            </div>
        </div>
    </header>

      <!-- Main Content -->
      <main id="main-content" style="margin-top: var(--header-height); padding: 0; overflow: hidden;">

          <!-- Schedule View - Subfas 1.3 -->
          <div class="schedule-wrapper">
              <div class="schedule-container" id="schedule-container" role="region" aria-label="T√•gschema">
                  <!-- Corner cell -->
                  <div class="schedule-corner">Sp√•r</div>

                  <!-- Timeline header -->
                  <div class="schedule-timeline-header">
                      <div class="timeline-hours" id="timeline-hours">
                          <!-- Dynamically generated time markers -->
                      </div>
                  </div>

                  <!-- Track labels -->
                  <div class="schedule-track-labels" id="track-labels">
                      <!-- Dynamically generated track rows -->
                  </div>

                  <!-- Timeline grid area -->
                  <div class="schedule-grid-area" id="schedule-grid">
                      <div class="timeline-canvas" id="timeline-canvas">
                          <!-- Track rows and train bars are rendered here by JS -->
        </div>
    </div>

                  <div class="schedule-scroll-hint">‚Üê Scrolla horisontellt ‚Üí</div>
              </div>
          </div>
      </main>

    <!-- Settings Modal -->
    <div id="settings-backdrop" class="settings-backdrop hidden" role="dialog" aria-labelledby="settings-title" aria-modal="true">
        <div id="settings-modal" class="settings-modal">
            <!-- Header -->
            <div class="settings-header">
                <h2 id="settings-title" class="settings-title">Inst√§llningar</h2>
                <button id="settings-close-btn" class="settings-close-btn" aria-label="St√§ng inst√§llningar">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <!-- Tabs Navigation -->
            <div class="settings-tabs" role="tablist">
                <button class="settings-tab active" data-tab="time" role="tab" aria-selected="true" aria-controls="panel-time">
                    Tidshantering
                </button>
                <button class="settings-tab" data-tab="display" role="tab" aria-selected="false" aria-controls="panel-display">
                    Visning
                </button>
                <button class="settings-tab" data-tab="delays" role="tab" aria-selected="false" aria-controls="panel-delays">
                    F√∂rseningar
                </button>
                <button class="settings-tab" data-tab="data" role="tab" aria-selected="false" aria-controls="panel-data">
                    Data
                </button>
                <button class="settings-tab" data-tab="about" role="tab" aria-selected="false" aria-controls="panel-about">
                    Om
                </button>
            </div>

            <!-- Content Area -->
            <div class="settings-content">
                <!-- Time Management Tab -->
                <div id="panel-time" class="settings-tab-panel active" data-tab-panel="time" role="tabpanel">
                    <div class="settings-section">
                        <h3 class="settings-section-title">Nu-knapp & Tidshantering</h3>
                        <div class="settings-section-content">
                            <!-- Offset Slider -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label" for="offset-slider">R√∂d linje position</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="slider-wrapper">
                                    <input id="offset-slider" type="range" min="0" max="50" value="20" class="slider" data-unit="%">
                                    <span class="slider-value">20%</span>
                                </div>
                                <p class="form-help">Position f√∂r r√∂d linje fr√•n v√§nsterkanten (0-50%). Vid 20% √§r linjen n√§ra v√§nster kant, vid 50% i mitten av sk√§rmen.</p>
                            </div>

                            <!-- Follow Mode Toggle -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label">Aktivera f√∂lj-l√§ge</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="toggle-switch" id="follow-mode" role="switch" aria-checked="false" tabindex="0">
                                    <div class="toggle-thumb"></div>
                                </div>
                                <p class="form-help">Aktiverar automatisk scrollning som f√∂ljer tiden. G√•r √§ven att aktivera/inaktivera genom att dubbelklicka p√• "Nu" knappen.</p>
                            </div>

                            <!-- Update Interval Select -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label">Uppdateringsintervall</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="custom-select">
                                    <button class="custom-select-button" id="update-interval" aria-expanded="false">
                                        60 sekunder
                                        <div class="custom-select-chevron">‚ñº</div>
                                    </button>
                                    <div class="custom-select-menu">
                                        <div class="custom-select-option" data-value="30">30 sekunder</div>
                                        <div class="custom-select-option selected" data-value="60">60 sekunder</div>
                                        <div class="custom-select-option" data-value="120">120 sekunder</div>
                                        <div class="custom-select-option" data-value="300">5 minuter</div>
                                    </div>
                                </div>
                                <p class="form-help">Hur ofta vyn ska uppdateras i f√∂lj-l√§ge.</p>
                            </div>
                    </div>
                    </div>
                </div>

                <!-- Display Tab -->
                <div id="panel-display" class="settings-tab-panel" data-tab-panel="display" role="tabpanel" hidden>
                    <div class="settings-section">
                        <h3 class="settings-section-title">T√•gf√§rger</h3>
                        <div class="settings-section-content">
                            <!-- Color Mode Select -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label" for="train-color-mode">F√§rgl√§ge</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="custom-select">
                                    <button class="custom-select-button" id="train-color-mode" aria-expanded="false">
                                        Efter l√§ngd
                                        <div class="custom-select-chevron">‚ñº</div>
                                    </button>
                                    <div class="custom-select-menu">
                                        <div class="custom-select-option selected" data-value="length">Efter l√§ngd</div>
                                        <div class="custom-select-option" data-value="single">Enf√§rgad</div>
                                    </div>
                                </div>
                                <p class="form-help">F√§rgkoda efter t√•gl√§ngd eller anv√§nd samma f√§rg f√∂r alla.</p>
                            </div>

                            <!-- Length Theme Select -->
                            <div class="form-control" id="length-theme-controls">
                                <div class="form-label-wrapper">
                                    <label class="form-label" for="length-theme">F√§rgtema (efter l√§ngd)</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="custom-select">
                                    <button class="custom-select-button" id="length-theme" aria-expanded="false">
                                        Modern (ljust gr√•)
                                        <div class="custom-select-chevron">‚ñº</div>
                                    </button>
                                    <div class="custom-select-menu">
                                        <div class="custom-select-option" data-value="custom">Anpassad</div>
                                        <div class="custom-select-option selected" data-value="modern">Modern (ljust gr√•)</div>
                                        <div class="custom-select-option" data-value="highvis">H√∂gsynlighet</div>
                                        <div class="custom-select-option" data-value="dark">M√∂rka f√§rger</div>
                                        <div class="custom-select-option" data-value="simon">Simon f√§rger üíÄ</div>
                                    </div>
                                </div>
                                <p class="form-help">V√§lj ett f√§rdigt tema eller anpassa manuellt nedan.</p>
                            </div>

                            <!-- Single Theme Select -->
                            <div class="form-control" id="single-color-controls" style="display:none;">
                                <div class="form-label-wrapper">
                                    <label class="form-label" for="single-theme">F√§rgtema (enf√§rgat)</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="custom-select">
                                    <button class="custom-select-button" id="single-theme" aria-expanded="false">
                                        Neutral gr√•
                                        <div class="custom-select-chevron">‚ñº</div>
                                    </button>
                                    <div class="custom-select-menu">
                                        <div class="custom-select-option" data-value="custom">Anpassad</div>
                                        <div class="custom-select-option selected" data-value="neutral">Neutral gr√•</div>
                                        <div class="custom-select-option" data-value="blue">Bl√•</div>
                                        <div class="custom-select-option" data-value="green">Gr√∂n</div>
                                        <div class="custom-select-option" data-value="amber">Gul</div>
                                        <div class="custom-select-option" data-value="simon">Simon f√§rger üíÄ</div>
                                    </div>
                                </div>
                                <div class="settings-color-row-simple" style="margin-top: var(--spacing-3);">
                                    <label class="color-simple-label">Bakgrund <input id="single-bg" type="color" class="settings-color-simple"></label>
                                    <label class="color-simple-label">Kant <input id="single-border" type="color" class="settings-color-simple"></label>
                                    <label class="color-simple-label">Text <input id="single-text" type="color" class="settings-color-simple"></label>
                                </div>
                                <p class="form-help">V√§lj tema eller anpassa f√§rger manuellt.</p>
                            </div>

                            <!-- Preview Section -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label">F√∂rhandsvisning</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div id="train-preview" class="train-preview">
                                    <div class="preview-train" data-bucket="b1">b1</div>
                                    <div class="preview-train" data-bucket="b2">b2</div>
                                    <div class="preview-train" data-bucket="b3">b3</div>
                                    <div class="preview-train" data-bucket="b4">b4</div>
                                    <div class="preview-train" data-bucket="b5">b5</div>
                                </div>
                                <p class="form-help">S√• h√§r ser dina f√§rger ut.</p>
                            </div>

                            <!-- Advanced Settings Button -->
                            <div style="margin-top: var(--spacing-4);">
                                <button id="show-advanced-btn" class="btn btn-secondary btn-sm">
                                    Visa avancerat
                                </button>
                            </div>

                            <!-- Advanced Color Controls -->
                            <div id="advanced-train-colors" style="display:none;">
                                <div style="margin-top: var(--spacing-6); padding: var(--spacing-4); border-radius: var(--radius-lg); background: var(--surface-tertiary); border: 1px solid var(--border-secondary);">
                                    <div class="form-control">
                                        <div class="form-label-wrapper">
                                            <label class="form-label" for="train-color-dimension">L√§ngdm√•tt</label>
                                            <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                        </div>
                                        <div class="custom-select">
                                            <button class="custom-select-button" id="train-color-dimension" aria-expanded="false">
                                                Fordonstyp
                                                <div class="custom-select-chevron">‚ñº</div>
                                            </button>
                                            <div class="custom-select-menu">
                                                <div class="custom-select-option selected" data-value="base">Fordonstyp</div>
                                                <div class="custom-select-option" data-value="total">Total t√•gl√§ngd</div>
                                            </div>
                                        </div>
                                        <p class="form-help">F√§rgning baserad p√• fordonets l√§ngd eller hela s√§ttets l√§ngd.</p>
                                    </div>

                                    <div class="form-control">
                                        <div class="form-label-wrapper">
                                            <label class="form-label">Kanoniska l√§ngder (m)</label>
                                            <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                        </div>
                                        <div class="settings-grid-5-compact">
                                            <input id="len-canon-1" type="number" inputmode="numeric" min="1" class="settings-input-compact" value="50">
                                            <input id="len-canon-2" type="number" inputmode="numeric" min="1" class="settings-input-compact" value="75">
                                            <input id="len-canon-3" type="number" inputmode="numeric" min="1" class="settings-input-compact" value="80">
                                            <input id="len-canon-4" type="number" inputmode="numeric" min="1" class="settings-input-compact" value="107">
                                            <input id="len-canon-5" type="number" inputmode="numeric" min="1" class="settings-input-compact" value="135">
                                        </div>
                                        <p class="form-help">L√§ngdintervall f√∂r b1‚Äìb5 (system v√§ljer n√§rmaste).</p>
                                    </div>

                                    <div class="form-control">
                                        <div class="form-label-wrapper">
                                            <label class="form-label">Anpassa f√§rger per bucket</label>
                                            <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                        </div>
                                        <div class="settings-color-grid-compact">
                                            <div class="color-row-compact">
                                                <span class="color-label-compact">b1</span>
                                                <input id="len-b1-bg" type="color" class="settings-color-compact">
                                                <input id="len-b1-border" type="color" class="settings-color-compact">
                                                <input id="len-b1-text" type="color" class="settings-color-compact">
                                            </div>
                                            <div class="color-row-compact">
                                                <span class="color-label-compact">b2</span>
                                                <input id="len-b2-bg" type="color" class="settings-color-compact">
                                                <input id="len-b2-border" type="color" class="settings-color-compact">
                                                <input id="len-b2-text" type="color" class="settings-color-compact">
                                            </div>
                                            <div class="color-row-compact">
                                                <span class="color-label-compact">b3</span>
                                                <input id="len-b3-bg" type="color" class="settings-color-compact">
                                                <input id="len-b3-border" type="color" class="settings-color-compact">
                                                <input id="len-b3-text" type="color" class="settings-color-compact">
                                            </div>
                                            <div class="color-row-compact">
                                                <span class="color-label-compact">b4</span>
                                                <input id="len-b4-bg" type="color" class="settings-color-compact">
                                                <input id="len-b4-border" type="color" class="settings-color-compact">
                                                <input id="len-b4-text" type="color" class="settings-color-compact">
                                            </div>
                                            <div class="color-row-compact">
                                                <span class="color-label-compact">b5</span>
                                                <input id="len-b5-bg" type="color" class="settings-color-compact">
                                                <input id="len-b5-border" type="color" class="settings-color-compact">
                                                <input id="len-b5-text" type="color" class="settings-color-compact">
                                            </div>
                                        </div>
                                        <p class="form-help">L√§mna standard eller anpassa manuellt (bg/kant/text).</p>
                                    </div>
                                </div>
                            </div>
                    </div>
                    </div>
                </div>

                <!-- Delays Tab -->
                <div id="panel-delays" class="settings-tab-panel" data-tab-panel="delays" role="tabpanel" hidden>
                    <div class="settings-section">
                        <h3 class="settings-section-title">Varningar & Konflikter</h3>
                        <div class="settings-section-content">
                            <!-- Show Warnings Toggle -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label">Visa konfliktvarningar</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="toggle-switch" id="delay-show-warnings" role="switch" aria-checked="true" tabindex="0">
                                    <div class="toggle-thumb"></div>
                                </div>
                                <p class="form-help">Visa varning n√§r f√∂rsenade t√•g p√•verkar andra t√•g</p>
                            </div>

                            <!-- Conflict Tolerance Slider -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label" for="delay-conflict-tolerance">Konflikttolerans</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="slider-wrapper">
                                    <input id="delay-conflict-tolerance" type="range" min="0" max="15" value="5" class="slider" data-unit=" min">
                                    <span class="slider-value">5 min</span>
                                </div>
                                <p class="form-help">Tidsf√∂nster f√∂r varningsmeddelanden</p>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="settings-section-title">Visualisering</h3>
                        <div class="settings-section-content">
                            <!-- Visualization Mode - Segmented Control -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label">Visualiseringsl√§ge</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="radio-group">
                                    <div class="radio-group-option">
                                        <input id="delay-mode-offset" type="radio" name="delay-mode" value="offset" checked class="radio-group-input">
                                        <label for="delay-mode-offset" class="radio-group-label">Overlay</label>
                                    </div>
                                    <div class="radio-group-option">
                                        <input id="delay-mode-icon" type="radio" name="delay-mode" value="icon" class="radio-group-input">
                                        <label for="delay-mode-icon" class="radio-group-label">Ikon</label>
                                    </div>
                                    <div class="radio-group-option">
                                        <input id="delay-mode-both" type="radio" name="delay-mode" value="both" class="radio-group-input">
                                        <label for="delay-mode-both" class="radio-group-label">B√•da</label>
                                    </div>
                                </div>
                                <p class="form-help">V√§lj hur f√∂rseningar ska visas p√• t√•gstaplar</p>
                            </div>

                            <!-- Visualization Style - Custom Select -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label" for="delay-visualization-style">F√∂rsening stil</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="custom-select">
                                    <button class="custom-select-button" id="delay-visualization-style" aria-expanded="false">
                                        F√§rgkodad (standard)
                                        <div class="custom-select-chevron">‚ñº</div>
                                    </button>
                                    <div class="custom-select-menu">
                                        <div class="custom-select-option selected" data-value="color-coded">F√§rgkodad (standard)</div>
                                        <div class="custom-select-option" data-value="transparent">Transparent</div>
                                        <div class="custom-select-option" data-value="dashed">Streckad kant</div>
                                    </div>
                                </div>
                                <p class="form-help">Hur f√∂rseningar visas p√• t√•gstapeln</p>
                            </div>

                            <!-- Turnaround Time Slider -->
                            <div class="form-control">
                                <div class="form-label-wrapper">
                                    <label class="form-label" for="delay-turnaround-time">V√§ndtid (buffert)</label>
                                    <button class="form-help-toggle" aria-expanded="false" aria-label="Visa hj√§lptext">‚ìò</button>
                                </div>
                                <div class="slider-wrapper">
                                    <input id="delay-turnaround-time" type="range" min="5" max="30" value="10" class="slider" data-unit=" min">
                                    <span class="slider-value">10 min</span>
                                </div>
                                <p class="form-help">Buffert f√∂r t√∂mning, personalbyte och p√•fyllning</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Tab -->
                <div id="panel-data" class="settings-tab-panel" data-tab-panel="data" role="tabpanel" hidden>
                    <div class="settings-empty">
                        <p>Kommer snart</p>
                    </div>
                </div>

                <!-- About Tab -->
                <div id="panel-about" class="settings-tab-panel" data-tab-panel="about" role="tabpanel" hidden>
                    <div class="settings-section">
                        <div class="settings-section-content">
                            <div class="setting-item">
                                <h3 class="setting-label">Sp√•rplanV2</h3>
                                <p class="setting-help"></p>
                            </div>
                            <div class="setting-item">
                                <p class="setting-help" style="font-size: var(--text-xs);">Version 2.0.0</p>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

            <!-- Footer -->
            <div class="settings-footer">
                <button id="settings-reset-btn" class="btn btn-secondary">
                    √Öterst√§ll standardv√§rden
                </button>
                <div class="settings-footer-actions">
                    <button id="settings-cancel-btn" class="btn btn-secondary">
                        Avbryt
                    </button>
                    <button id="settings-save-btn" class="btn btn-primary">
                        Spara
                    </button>
                </div>
            </div>
        </div>
    </div>

    

    <!-- JavaScript Files - Load in correct order -->
    <!-- 1. Core utilities -->
    <script src="js/utils/debug-logger.js"></script>
    
    <!-- 2. Theme system -->
    <script src="js/theme.js"></script>
    
    <!-- 3. Time management -->
    <script src="js/modules/time-manager.js"></script>
    
    <!-- 4. Settings -->
    <script src="js/components/settings-controls.js"></script>
    <script src="js/components/forms.js"></script>
    <script src="js/components/settings-modal.js"></script>
    <script src="js/components/settings-delay.js"></script>
    
    <!-- 5. Delay API & Data -->
    <script src="js/api/delay-api-client.js"></script>
    <script src="js/api/delay-data-manager.js"></script>
    
    <!-- 6. Delay Logic -->
    <script src="js/delay/conflict-detector.js"></script>
    <script src="js/delay/visualizers/offset-visualizer.js"></script>
    <script src="js/delay/visualizers/icon-visualizer.js"></script>
    <script src="js/delay/visualizers/combined-visualizer.js"></script>
    <script src="js/delay/delay-integration.js"></script>
    
    <!-- 7. Header & Schedule -->
    <script src="js/modules/header-controls.js"></script>
    <!-- Schedule renderer modules (load in dependency order) -->
    <script src="js/modules/color-utils.js"></script>
    <script src="js/modules/train-positioning.js"></script>
    <script src="js/modules/timeline-renderer.js"></script>
    <script src="js/modules/train-renderer.js"></script>
    <script src="js/modules/schedule-renderer.js"></script>
    
    <!-- 8. Main app -->
    <script src="js/app.js"></script>
    
    <!-- 9. UI Components -->
    <script src="js/components/theme-switch.js"></script>
    <script src="js/components/search-inline.js"></script>
    <script src="js/components/search-trains.js"></script>
    <script src="js/components/track-tooltip.js"></script>
    <script src="js/components/train-tooltip.js"></script>
    <script src="js/components/debug-logs.js"></script>
    
    <script>
        // Legacy theme switcher function for compatibility
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('sparplannen-theme', theme);
            console.log(`‚úÖ Theme switched to: ${theme}`);
        }
    </script>
</body>
</html>

